function MatchController(){Controller.call(this),this.pageSize=5,this.initPage(),this.bindEvent()}!function(e){e.fn.pullload=function(a){var i=e.extend({},e.fn.pullload.defaults,a);return this.each(function(){var a=this;e(this).attr("requestable","true"),e(i.handler).on("scroll.pullload",function(){var t=e(window).height(),l=e(window).scrollTop(),o=e(a).children().last(),s=o.height()+o.offset().top+i.threshold;t+l>s&&"true"==e(a).attr("requestable")&&e.fn.pullload.request(a,i)})})},e.fn.pullload.request=function(a,i){e(a).attr("requestable","false");var t=i.crossDomain?"jsonp":"json",l=i.crossDomain?"GET":i.requestType,o=e(a).data("page-index")||2,s={};"0"==i.mode?s[i.requestLoadedKey]=e(a).children().size():(s[i.pageSizeKey]=i.pageSize,s[i.pageIndexKey]=o),e.fn.pullload.tips(i.loadingTips,a,i);try{e.ajax({url:i.apiUrl,type:l,dataType:t,data:s,success:function(t){return i.callback&&i.callback(t),"1"==i.mode&&e(a).data("page-index",++o),e.fn.pullload.getTotalCount(t,i.countKey)?void(e.fn.pullload.getTotalCount(t,i.countKey)<=e(a).children().size()?(e.fn.pullload.tips(i.lastLoadedTips,a,i),e(i.handler).off("scroll.pullload")):(e(a).attr("requestable","true"),e.fn.pullload.closeTips(a,i))):void e.fn.pullload.tips("您的数据接口好像没有给出总条数嘛！",a,i)},error:function(t){e.fn.pullload.tips(i.loadFailedTips,a,i)}})}catch(n){e.fn.pullload.tips("错误名称："+n.name+"\n错误描述："+n.message)}},e.fn.pullload.tips=function(a,i,t){t.isShowLoadingTips&&(0===e(i).next("."+t.tipsClassName).size()&&e(i).after('<div class="'+t.tipsClassName+'"></div>'),e(i).next("."+t.tipsClassName).html(a),e(i).next("."+t.tipsClassName).slideDown(100))},e.fn.pullload.closeTips=function(a,i){i.isShowLoadingTips&&e(a).next("."+i.tipsClassName).slideUp(100)},e.fn.pullload.getTotalCount=function(e,a){var i=[];return a.indexOf(".")>0&&(i=a.split("."),i[0]&&i[1])?e[i[0]][i[1]]:e[a]},e.fn.pullload.defaults={handler:window,apiUrl:"",crossDoman:!1,requestType:"GET",callback:null,requestLoadedKey:"loaded",countKey:"count",tipsClassName:"data-status",loadingTips:"数据加载中...",lastLoadedTips:"已经加载到最后一页！",loadFailedTips:"数据加载失败，请重试！",threshold:50,isShowLoadingTips:!1,pageIndexKey:"pageIndex",pageSizeKey:"pageSize",pageSize:"10",mode:"1"}}(jQuery),define("components/pullload.js",function(){}),MatchController.prototype.initPage=function(){var e=this;e.request(e.apiUrl.match.getOnline,{pageIndex:1,pageSize:e.pageSize},{showLoadingTips:!0,process:function(a){e.renderList(a),e.initPullLoad()}})},MatchController.prototype.initPullLoad=function(){var e=this;require(["components/pullload.js"],function(){$(".match-list").pullload({apiUrl:e.apiUrl.match.getOnline,threshold:15,crossDoman:!1,pageSize:e.pageSize,countKey:"data.count",callback:function(a){e.renderList(a.data,!0)}})})},MatchController.prototype.renderList=function(e,a){var i=this,t=$(".match-list");if(!a&&(t.empty(),!e.count)){var l='<div class="weui-loadmore weui-loadmore_line">';l+='<span class="weui-loadmore__tips">暂无数据</span>',l+="</div>",t.append(l)}$.each(e.rows,function(e,a){t.append(i.getItem(a))})},MatchController.prototype.getItem=function(e){var a=this,i={},t=$("#memberLevelId").val().toString();$.each(e.matchConfig.matchPrices,function(e,a){a.type.toString()===t&&(i={id:a.id,price:a.price})});var l="";return l+='<div class="weui-form-preview">',l+='<div class="weui-form-preview__hd">',l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">赛事名称</label>',l+='<em class="weui-form-preview__value name">'+e.matchConfig.name+"</em>",l+="</div>",l+="</div>",l+='<div class="weui-form-preview__bd">',l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">类型</label>',l+='<span class="weui-form-preview__value">'+e.matchConfig.Type.name+"【"+e.matchConfig.subType.name+"】</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">举办方</label>',l+='<span class="weui-form-preview__value">'+e.matchConfig.holder+"</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">门票费用</label>',l+='<span class="weui-form-preview__value price">¥'+(i.price||"未公布")+"</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">报名截止</label>',l+='<span class="weui-form-preview__value">'+a.utcToLocal(e.closingDatetime)+"</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">比赛时间</label>',l+='<span class="weui-form-preview__value">'+a.utcToLocal(e.openingDatetime)+"</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">报名参赛人数</label>',l+='<span class="weui-form-preview__value">'+e.attendances.length+" 人</span>",l+="</div>",l+='<div class="weui-form-preview__item">',l+='<label class="weui-form-preview__label">赛事介绍</label>',l+='<span class="weui-form-preview__value">'+e.matchConfig.description+"</span>",l+="</div>",l+="</div>",l+='<div class="weui-form-preview__ft">',l+='<a class="weui-form-preview__btn weui-form-preview__btn_primary" href="rewards?matchConfigId='+e.matchConfigId+"&matchName="+e.matchConfig.name+'">奖励</a>',l+='<a class="weui-form-preview__btn weui-form-preview__btn_primary attend" data-id="'+e.id+'" data-price="'+i.price+'" data-match-price-id="'+i.id+'" data-closing="'+e.closingDatetime+'" href="javascript:">报名</a>',l+="</div>",l+="</div>",$(l)},MatchController.prototype.bindEvent=function(){var e=this;$(".match-list").on("click",".attend",function(){var a=$(this).attr("data-price"),i=$(this).attr("data-id"),t=$(this).attr("data-match-price-id"),l=new Date(e.utcToLocal($(this).attr("data-closing"))),o=Date.now();return l<o?($.toast("报名时间已截止","forbidden"),!1):parseFloat(a)&&parseInt(t)?void $.confirm({title:"报名参赛？",text:"赛事门票为"+a+"元，是否报名参加？",onOK:function(){e.request(e.apiUrl.match.apply,{matchId:i,matchPriceId:t},{type:"post",process:function(e){$.toast("报名成功")}})},onCancel:function(){}}):($.toast("价格未公布，无法报名","forbidden"),!1)})},$(function(){new MatchController}),define("match/apply",function(){});