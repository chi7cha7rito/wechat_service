function CouponController(){Controller.call(this),this.pageSize=10,this.initPage()}!function(e){e.fn.pullload=function(l){var a=e.extend({},e.fn.pullload.defaults,l);return this.each(function(){var l=this;e(this).attr("requestable","true"),e(a.handler).on("scroll.pullload",function(){var o=e(window).height(),i=e(window).scrollTop(),s=e(l).children().last(),t=s.height()+s.offset().top+a.threshold;o+i>t&&"true"==e(l).attr("requestable")&&e.fn.pullload.request(l,a)})})},e.fn.pullload.request=function(l,a){e(l).attr("requestable","false");var o=a.crossDomain?"jsonp":"json",i=a.crossDomain?"GET":a.requestType,s=e(l).data("page-index")||2,t={};"0"==a.mode?t[a.requestLoadedKey]=e(l).children().size():(t[a.pageSizeKey]=a.pageSize,t[a.pageIndexKey]=s),e.fn.pullload.tips(a.loadingTips,l,a);try{e.ajax({url:a.apiUrl,type:i,dataType:o,data:t,success:function(o){return a.callback&&a.callback(o),"1"==a.mode&&e(l).data("page-index",++s),e.fn.pullload.getTotalCount(o,a.countKey)?void(e.fn.pullload.getTotalCount(o,a.countKey)<=e(l).children().size()?(e.fn.pullload.tips(a.lastLoadedTips,l,a),e(a.handler).off("scroll.pullload")):(e(l).attr("requestable","true"),e.fn.pullload.closeTips(l,a))):void e.fn.pullload.tips("您的数据接口好像没有给出总条数嘛！",l,a)},error:function(o){e.fn.pullload.tips(a.loadFailedTips,l,a)}})}catch(n){e.fn.pullload.tips("错误名称："+n.name+"\n错误描述："+n.message)}},e.fn.pullload.tips=function(l,a,o){o.isShowLoadingTips&&(0===e(a).next("."+o.tipsClassName).size()&&e(a).after('<div class="'+o.tipsClassName+'"></div>'),e(a).next("."+o.tipsClassName).html(l),e(a).next("."+o.tipsClassName).slideDown(100))},e.fn.pullload.closeTips=function(l,a){a.isShowLoadingTips&&e(l).next("."+a.tipsClassName).slideUp(100)},e.fn.pullload.getTotalCount=function(e,l){var a=[];return l.indexOf(".")>0&&(a=l.split("."),a[0]&&a[1])?e[a[0]][a[1]]:e[l]},e.fn.pullload.defaults={handler:window,apiUrl:"",crossDoman:!1,requestType:"GET",callback:null,requestLoadedKey:"loaded",countKey:"count",tipsClassName:"data-status",loadingTips:"数据加载中...",lastLoadedTips:"已经加载到最后一页！",loadFailedTips:"数据加载失败，请重试！",threshold:50,isShowLoadingTips:!1,pageIndexKey:"pageIndex",pageSizeKey:"pageSize",pageSize:"10",mode:"1"}}(jQuery),define("components/pullload.js",function(){}),CouponController.prototype.initPage=function(){var e=this;e.request(e.apiUrl.coupon.get,{pageIndex:1,pageSize:e.pageSize},{showLoadingTips:!0,process:function(l){e.renderList(l),e.initPullLoad()}})},CouponController.prototype.initPullLoad=function(){var e=this;require(["components/pullload.js"],function(){$(".balance-list").pullload({apiUrl:e.apiUrl.coupon.get,threshold:15,crossDoman:!1,pageSize:e.pageSize,countKey:"data.count",callback:function(l){e.renderList(l.data,!0)}})})},CouponController.prototype.renderList=function(e,l){var a=this,o=$(".coupon-list");if(!l&&(o.empty(),!e.count)){var i='<div class="weui-loadmore weui-loadmore_line">';i+='<span class="weui-loadmore__tips">暂无数据</span>',i+="</div>",o.append(i)}$.each(e.rows,function(e,l){o.append(a.getItem(l))})},CouponController.prototype.getItem=function(e){var l,a;"2"==e.status?(l="已使用",a="used"):"3"==e.status?(l="已作废",a="used",a="aborted"):(l="未使用",a="unused");var o="";return o+='<div class="weui-form-preview">',o+='<div class="weui-form-preview__hd">',o+='<div class="weui-form-preview__item">',o+='<label class="weui-form-preview__label">类型</label>',o+='<em class="weui-form-preview__value">'+e.type.name+"</em>",o+="</div>",o+="</div>",o+='<div class="weui-form-preview__bd">',o+='<div class="weui-form-preview__item">',o+='<label class="weui-form-preview__label">用途</label>',o+='<span class="weui-form-preview__value status">'+e.subType.name+"</span>",o+="</div>",o+='<div class="weui-form-preview__item">',o+='<label class="weui-form-preview__label">来源</label>',o+='<span class="weui-form-preview__value">'+e.source.name+"</span>",o+="</div>",o+='<div class="weui-form-preview__item">',o+='<label class="weui-form-preview__label">状态</label>',o+='<span class="weui-form-preview__value '+a+'">'+l+"</span>",o+="</div>",o+="</div>",o+="</div>",$(o)},$(function(){new CouponController}),define("personal/coupon",function(){});