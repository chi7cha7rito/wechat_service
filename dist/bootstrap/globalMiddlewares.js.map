{"version":3,"sources":["../../src/bootstrap/globalMiddlewares.js"],"names":["app","use","json","urlencoded","extended","secret","session","cookie","timeout","resave","saveUninitialized","isArray","middlewaresConfig","global","length","c","isFunction","middlewares","getModules","getMiddlewares"],"mappings":";;;;;;;;;;kBAWe,UAAUA,GAAV,EAAe;AAC5B;;;;;AAKAA,MAAIC,GAAJ,CAAQ,qBAAWC,IAAX,EAAR;AACAF,MAAIC,GAAJ,CAAQ,qBAAWE,UAAX,CAAsB,EAAEC,UAAU,KAAZ,EAAtB,CAAR;;AAEA;;;AAGAJ,MAAIC,GAAJ,CAAQ,6BAAR;;AAEA;;;AAGAD,MAAIC,GAAJ,CAAQ,8BAAQ;AACdI,YAAQ,cAASC,OAAT,CAAiBD,MADX;AAEdE,YAAQ,cAASD,OAAT,CAAiBE,OAFX;AAGdC,YAAQ,KAHM;AAIdC,uBAAmB;AAJL,GAAR,CAAR;;AAOA;;;AAGA,MAAI,iBAAEC,OAAF,CAAUC,kBAAkBC,MAA5B,KAAuCD,kBAAkBC,MAAlB,CAAyBC,MAApE,EAA4E;AAAA;AAAA;AAAA;;AAAA;AAC1E,sDAAcF,kBAAkBC,MAAhC,4GAAwC;AAAA,YAA/BE,CAA+B;;AACtC,YAAI,iBAAEC,UAAF,CAAaC,YAAYF,CAAZ,EAAe,SAAf,CAAb,CAAJ,EAA6Cf,IAAIC,GAAJ,CAAQgB,YAAYF,CAAZ,EAAe,SAAf,CAAR;AAC9C;AAHyE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI3E;AACF,C;;AA3CD;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIE,cAAc,iBAAOC,UAAP,CAAkB,oBAAlB,CAAlB;AACA,IAAIN,oBAAoB,iBAAOO,cAAP,EAAxB","file":"globalMiddlewares.js","sourcesContent":["import loader from '../utils/loader'\nimport bodyParser from 'body-parser'\nimport cookieParser from 'cookie-parser'\nimport session from 'express-session'\nimport config from '../utils/config'\nimport appConfs from '../../configs/app'\nimport _ from 'lodash'\n\nlet middlewares = loader.getModules('middlewares/global')\nlet middlewaresConfig = config.getMiddlewares()\n\nexport default function (app) {\n  /**\n   * desc:bodyParser是Connect內建的middleware，下面先加载这个中间件\n   * 设置此处可以将client提交过来的post请求放入request.body中。\n   */\n\n  app.use(bodyParser.json())\n  app.use(bodyParser.urlencoded({ extended: false }))\n\n  /**\n   * desc:将请求的cookie都解析出来\n   */\n  app.use(cookieParser())\n\n  /**\n   * desc:配置session\n   */\n  app.use(session({\n    secret: appConfs.session.secret,\n    cookie: appConfs.session.timeout,\n    resave: false,\n    saveUninitialized: true\n  }))\n\n  /**\n  * desc:注册全局中间件到app中\n  */\n  if (_.isArray(middlewaresConfig.global) && middlewaresConfig.global.length) {\n    for (let c of middlewaresConfig.global) {\n      if (_.isFunction(middlewares[c]['default'])) app.use(middlewares[c]['default'])\n    }\n  }\n}\n"]}