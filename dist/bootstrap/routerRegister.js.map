{"version":3,"sources":["../../src/bootstrap/routerRegister.js"],"names":["app","renderRoutes","routers","render","apiRoutes","api","debugRoutes","debug","forEach","key","use","renderMiddlewares","apiMiddlewares","getModules","middlewaresConfig","getMiddlewares","renderModules","apiModules","stageEnv","process","env","STAGE_ENV","isArray","length","c","isFunction","push"],"mappings":";;;;;;;;;;;;;;kBA8Ce,UAAUA,GAAV,EAAe;AAC5B,MAAIC,eAAeC,QAAQC,MAA3B;AACA,MAAIC,YAAYF,QAAQG,GAAxB;AACA,MAAIC,cAAcJ,QAAQK,KAA1B;;AAEA;AACA,sBAAYN,YAAZ,EAA0BO,OAA1B,CAAkC,UAAUC,GAAV,EAAe;AAC/C,QAAIA,QAAQ,MAAZ,EAAoBT,IAAIU,GAAJ,CAAQ,GAAR,YAAiBC,iBAAjB,GAAoCV,aAAaQ,GAAb,CAApC,IAD2B,CAC8B;AAC7ET,QAAIU,GAAJ,CAAQ,MAAMD,GAAd,YAAuBE,iBAAvB,GAA0CV,aAAaQ,GAAb,CAA1C;AACD,GAHD;;AAKA;AACA,MAAIL,SAAJ,EAAe;AACb,wBAAYA,SAAZ,EAAuBI,OAAvB,CAA+B,UAAUC,GAAV,EAAe;AAC5CT,UAAIU,GAAJ,CAAQ,UAAUD,GAAlB,YAA2BG,cAA3B,GAA2CR,UAAUK,GAAV,CAA3C;AACD,KAFD;AAGD;AACF,C;;AA1DD;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;;;AAVA;;;;;AAaA,IAAIP,UAAU,iBAAOW,UAAP,CAAkB,SAAlB,CAAd;;AAEA;;;AAGA,IAAIC,oBAAoB,iBAAOC,cAAP,EAAxB;AACA,IAAIC,gBAAgB,iBAAOH,UAAP,CAAkB,oBAAlB,CAApB;AACA,IAAII,aAAa,iBAAOJ,UAAP,CAAkB,iBAAlB,CAAjB;;AAEA,IAAIF,oBAAoB,EAAxB;AACA,IAAIC,iBAAiB,EAArB;;AAEA,IAAIM,WAAWC,QAAQC,GAAR,CAAYC,SAAZ,IAAyB,KAAxC;;AAGA;;;AAGA,IAAI,iBAAEC,OAAF,CAAUR,kBAAkBT,GAA5B,KAAoCS,kBAAkBT,GAAlB,CAAsBkB,MAA9D,EAAsE;AAAA;AAAA;AAAA;;AAAA;AACpE,oDAAcT,kBAAkBT,GAAhC,4GAAqC;AAAA,UAA5BmB,CAA4B;;AACnC,UAAI,iBAAEC,UAAF,CAAaR,WAAWO,CAAX,EAAc,SAAd,CAAb,CAAJ,EAA4CZ,eAAec,IAAf,CAAoBT,WAAWO,CAAX,EAAc,SAAd,CAApB;AAC7C;AAHmE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIrE;;AAED;;;AAGA,IAAI,iBAAEF,OAAF,CAAUR,kBAAkBX,MAA5B,KAAuCW,kBAAkBX,MAAlB,CAAyBoB,MAApE,EAA4E;AAAA;AAAA;AAAA;;AAAA;AAC1E,qDAAcT,kBAAkBX,MAAhC,iHAAwC;AAAA,UAA/BqB,EAA+B;;AACtC,UAAI,iBAAEC,UAAF,CAAaT,cAAcQ,EAAd,EAAiB,SAAjB,CAAb,CAAJ,EAA+Cb,kBAAkBe,IAAlB,CAAuBV,cAAcQ,EAAd,EAAiB,SAAjB,CAAvB;AAChD;AAHyE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI3E","file":"routerRegister.js","sourcesContent":["/**\n * desc:注册路由与路由中间件\n * author:luwei@lifang.com\n */\n\nimport loader from '../utils/loader'\nimport config from '../utils/config'\nimport _ from 'lodash'\nimport wechatPay from 'wechat-pay'\n\n/**\n * desc:加载router\n */\nlet routers = loader.getModules('routers')\n\n/**\n * desc:加载middlewares\n */\nlet middlewaresConfig = config.getMiddlewares()\nlet renderModules = loader.getModules('middlewares/render')\nlet apiModules = loader.getModules('middlewares/api')\n\nlet renderMiddlewares = []\nlet apiMiddlewares = []\n\nlet stageEnv = process.env.STAGE_ENV || 'dev'\n\n\n/**\n * desc:根据app.json中middlewares配置顺序组装api中间件\n */\nif (_.isArray(middlewaresConfig.api) && middlewaresConfig.api.length) {\n  for (let c of middlewaresConfig.api) {\n    if (_.isFunction(apiModules[c]['default'])) apiMiddlewares.push(apiModules[c]['default'])\n  }\n}\n\n/**\n * desc:根据app.json中middlewares配置顺序组装reder中间件\n */\nif (_.isArray(middlewaresConfig.render) && middlewaresConfig.render.length) {\n  for (let c of middlewaresConfig.render) {\n    if (_.isFunction(renderModules[c]['default'])) renderMiddlewares.push(renderModules[c]['default'])\n  }\n}\n\nexport default function (app) {\n  let renderRoutes = routers.render\n  let apiRoutes = routers.api\n  let debugRoutes = routers.debug\n\n  // 添加 render routers\n  Object.keys(renderRoutes).forEach(function (key) {\n    if (key === 'home') app.use('/', [...renderMiddlewares, renderRoutes[key]]); // 如果是home添加'/'路由支持\n    app.use('/' + key, [...renderMiddlewares, renderRoutes[key]])\n  })\n\n  // 添加 api routers\n  if (apiRoutes) {\n    Object.keys(apiRoutes).forEach(function (key) {\n      app.use('/api/' + key, [...apiMiddlewares, apiRoutes[key]])\n    })\n  }\n}\n"]}