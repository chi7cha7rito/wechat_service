{"version":3,"sources":["../../../src/routers/api/account.js"],"names":["router","Router","post","req","res","next","name","body","phoneNo","idCardNo","smsCode","wechatOpenId","session","wechatUser","openid","nickName","nickname","headImgUrl","headimgurl","dateNow","unix","smsCodeGenDate","json","requestHelper","resp","error","memberId","user","member","id","comment","module","exports"],"mappings":";;;;;;;;;;;;;;AAIA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,SAAS,kBAAQC,MAAR,EAAb;;AAEA;;;AAVA;;;;AAaAD,OAAOE,IAAP,CAAY,MAAZ;AAAA,0EAAmB,iBAAOC,GAAP,EAAWC,GAAX,EAAeC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPC,4BAFO,GAEFH,IAAII,IAAJ,CAASD,IAFP;AAGPE,+BAHO,GAGCL,IAAII,IAAJ,CAASC,OAHV;AAIPC,gCAJO,GAIEN,IAAII,IAAJ,CAASE,QAJX;AAKPC,+BALO,GAKCP,IAAII,IAAJ,CAASG,OALV;AAMPC,oCANO,GAMMR,IAAIS,OAAJ,CAAYC,UAAZ,CAAuBC,MAN7B;AAOPC,gCAPO,GAOEZ,IAAIS,OAAJ,CAAYC,UAAZ,CAAuBG,QAPzB;AAQPC,kCARO,GAQId,IAAIS,OAAJ,CAAYC,UAAZ,CAAuBK,UAR3B;AASPC,+BATO,GASC,wBAASC,IAAT,EATD;;AAAA,8BAWRD,UAAQhB,IAAIS,OAAJ,CAAYS,cAApB,GAAmC,IAX3B;AAAA;AAAA;AAAA;;AAAA,yDAYAjB,IAAIkB,IAAJ,CAAS;AACZ,sCAAS,GADG;AAEZ,uCAAU,SAFE;AAGZ,oCAAO;AAHK,yBAAT,CAZA;;AAAA;AAAA,8BAoBRnB,IAAIS,OAAJ,CAAYF,OAAZ,IAAqBA,OApBb;AAAA;AAAA;AAAA;;AAAA,yDAqBAN,IAAIkB,IAAJ,CAAS;AACZ,sCAAS,GADG;AAEZ,uCAAU,SAFE;AAGZ,oCAAO;AAHK,yBAAT,CArBA;;AAAA;AAAA;AAAA,+BA4BIC,cAAcrB,IAAd,CAAmB;AAC9B,0CAAa,cADiB;AAE9B,0CAAa,QAFiB;AAG9B,sCAAS,QAHqB;AAI9B,oCAAO;AACHI,0CADG;AAEHE,gDAFG;AAGHC,kDAHG;AAIHE,0DAJG;AAKHI,kDALG;AAMHE;AANG;AAJuB,yBAAnB,CA5BJ;;AAAA;AA4BPO,4BA5BO;;;AA0CXpB,4BAAIkB,IAAJ,CAASE,IAAT;;AA1CW;AAAA;;AAAA;AAAA;AAAA;;AA6CX,yCAAOC,KAAP,6BAAuC,qCAAvC;;AA7CW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAnB;;AAAA;AAAA;AAAA;AAAA;;AAkDA;;;AAGAzB,OAAOE,IAAP,CAAY,SAAZ;AAAA,2EAAsB,kBAAOC,GAAP,EAAWC,GAAX,EAAeC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEVqB,gCAFU,GAEDvB,IAAIS,OAAJ,CAAYe,IAAZ,CAAiBC,MAAjB,CAAwBC,EAFvB;AAGVC,+BAHU,GAGF3B,IAAII,IAAJ,CAASuB,OAHP;AAAA;AAAA,+BAICP,cAAcrB,IAAd,CAAmB;AAC9B,0CAAa,cADiB;AAE9B,0CAAa,QAFiB;AAG9B,sCAAS,QAHqB;AAI9B,oCAAO;AACJwB,kDADI;AAEJI;AAFI;AAJuB,yBAAnB,CAJD;;AAAA;AAIVN,4BAJU;;;AAcdpB,4BAAIkB,IAAJ,CAASE,IAAT;;AAdc;AAAA;;AAAA;AAAA;AAAA;;AAiBd,yCAAOC,KAAP,gCAA0C,sCAA1C;;AAjBc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAtB;;AAAA;AAAA;AAAA;AAAA;;AAqBAM,OAAOC,OAAP,GAAiBhC,MAAjB","file":"account.js","sourcesContent":["/**\n * desc:账户相关的api 定义\n */\n\nimport express from 'express'\nimport logger from '../../utils/logger';\nimport moment from 'moment';\n\nlet router = express.Router()\n\n/**\n * 用户注册\n */\nrouter.post(\"/add\",async (req,res,next)=>{\n    try{\n        let name=req.body.name;\n        let phoneNo=req.body.phoneNo;\n        let idCardNo=req.body.idCardNo;\n        let smsCode=req.body.smsCode;\n        let wechatOpenId=req.session.wechatUser.openid;\n        let nickName=req.session.wechatUser.nickname;\n        let headImgUrl=req.session.wechatUser.headimgurl;\n        let dateNow=moment().unix();\n\n        if(dateNow-req.session.smsCodeGenDate>1750){\n            return res.json({\n                \"status\":\"0\",\n                \"message\":\"短信验证码失效\",\n                \"data\":null\n            })\n        }\n\n\n        if(req.session.smsCode!=smsCode){\n            return res.json({\n                \"status\":\"0\",\n                \"message\":\"短信验证码错误\",\n                \"data\":null\n            })\n        }\n\n        let resp=await requestHelper.post({\n            \"moduleName\":\"hulk_service\",\n            \"controller\":\"member\",\n            \"action\":\"create\",\n            \"data\":{\n                name,\n                phoneNo,\n                idCardNo,\n                wechatOpenId,\n                nickName,\n                headImgUrl\n            }\n        })\n\n        res.json(resp);\n\n    }catch(e){\n        logger.error(`api_account_add_error=>${JSON.stringify(e)}`);\n    }\n})\n\n\n/**\n * 签到\n */\nrouter.post(\"/signIn\",async (req,res,next)=>{\n    try{\n        let memberId=req.session.user.member.id\n        let comment=req.body.comment;\n        let resp=await requestHelper.post({\n            \"moduleName\":\"hulk_service\",\n            \"controller\":\"signIn\",\n            \"action\":\"create\",\n            \"data\":{\n               memberId,\n               comment\n            }\n        })\n\n        res.json(resp);\n\n    }catch(e){\n        logger.error(`api_account_signIn_error=>${JSON.stringify(e)}`)\n    }\n})\n\nmodule.exports = router"]}