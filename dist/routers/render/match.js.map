{"version":3,"sources":["../../../src/routers/render/match.js"],"names":["router","Router","get","req","res","next","param","matchJavascript","matchStylesheet","requestHelper","wechatOpenId","session","user","member","wechat","memberInfo","templateData","getTemplateBasicData","memberLevelId","data","memberLevel","id","render","error","matchConfigId","query","rewards","total","length","forEach","x","i","rewardPoints","matchName","e","module","exports"],"mappings":"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","file":"match.js","sourcesContent":["import express from \"express\";\nimport logger from '../../utils/logger';\nimport routerUtil from \"../../utils/router\";\n\n\nlet router = express.Router();\n\n//比赛报名\nrouter.get('/apply',async (req, res, next) => {\n  try {\n    let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n  let memberInfo = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'member',\n      'action': 'find',\n      'data': {wechatOpenId:req.session.user.member.wechat.wechatOpenId}\n  })\n\n  let templateData = routerUtil.getTemplateBasicData(param);\n\n  Object.assign(templateData, { \"title\": \"在线报名\" },{memberLevelId:memberInfo.data.member.memberLevel.id});\n\n  return res.render(\"match/apply\", templateData);\n  } catch (e) {\n    logger.error(`render_match_apply_error=>${JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n//赛事预告\nrouter.get('/list',async (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let memberInfo = await requestHelper.get({\n        'moduleName': 'hulk_service',\n        'controller': 'member',\n        'action': 'find',\n        'data': {wechatOpenId:req.session.user.member.wechat.wechatOpenId}\n    })\n\n    let templateData = routerUtil.getTemplateBasicData(param);\n\n    Object.assign(templateData, { \"title\": \"赛事预告\" }, {memberLevelId:memberInfo.data.member.memberLevel.id});\n\n    return res.render(\"match/list\", templateData);\n  } catch (e) {\n    logger.error(`render_match_list_error=>${JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n//赛事奖励\nrouter.get('/rewards', async (req, res, next) => {\n  try {\n    let param = {\n    req: req,\n    matchJavascript: false,\n    matchStylesheet: true,\n    }\n    let rewards = await requestHelper.get({\n        'moduleName': 'hulk_service',\n        'controller': 'match',\n        'action': 'rewards',\n        'data': { matchConfigId: req.query.matchConfigId }\n    })\n    let templateData = routerUtil.getTemplateBasicData(param);\n    let total = 0\n    if(rewards.data && rewards.data.length >0) rewards.data.forEach((x,i)=> total += x.rewardPoints || 0 )\n    Object.assign(templateData, { \"title\": \"赛事奖励\" },{rewards:rewards.data,matchName:req.query.matchName,total:total});\n\n    return res.render(\"match/rewards\", templateData);\n  } catch (error) {\n    logger.error(`render_personal_list_error=>${JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n//比赛成绩\nrouter.get('/result', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param);\n\n  Object.assign(templateData, { \"title\": \"战绩\" });\n\n  return res.render(\"match/result\", templateData);\n})\n\n/**\n * @desc 赛事分享--豪客风采\n */\nrouter.get('/share',async (req,res,next)=>{\n   let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param);\n\n  Object.assign(templateData, { \"title\": \"豪客风采\" });\n\n  return res.render(\"match/share\", templateData);\n})\n\nmodule.exports = router"]}