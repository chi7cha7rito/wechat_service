{"version":3,"sources":["../../../src/routers/render/common.js"],"names":["router","Router","wechatConfig","getWechat","get","req","res","next","param","matchJavascript","matchStylesheet","templateData","getTemplateBasicData","render","error","query","secret","requestHelper","appid","accessTokenInfo","json","status","message","data","e","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,SAAS,kBAAQC,MAAR,EAAb;;AAEA,IAAIC,eAAe,iBAAOC,SAAP,EAAnB;;AAEA;;;AAGAH,OAAOI,GAAP,CAAW,QAAX;AAAA,wEAAqB,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEbC,iBAFa,GAEL;AACVH,mBAAKA,GADK;AAEVI,+BAAiB,IAFP;AAGVC,+BAAiB;AAHP,aAFK;AAQbC,wBARa,GAQE,iBAAWC,oBAAX,CAAgCJ,KAAhC,CARF;;;AAUjB,kCAAcG,YAAd,EAA4B,EAAE,SAAS,IAAX,EAA5B;;AAViB,6CAYVL,IAAIO,MAAJ,CAAW,cAAX,EAA2BF,YAA3B,CAZU;;AAAA;AAAA;AAAA;;AAcjB,6BAAOG,KAAP;;AAdiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArB;;AAAA;AAAA;AAAA;AAAA;;AAkBA;;;AAGAd,OAAOI,GAAP,CAAW,iBAAX;AAAA,yEAA8B,kBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACxBF,IAAIU,KAAJ,CAAUC,MAAV,IAAoBd,aAAac,MADT;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAEEC,cAAcb,GAAd,CAAkB;AAC5C,4BAAc,QAD8B;AAE5C,4BAAc,QAF8B;AAG5C,wBAAU,gBAHkC;AAI5C,sBAAQ;AACN,8BAAc,mBADR;AAEN,yBAASF,aAAagB,KAFhB;AAGN,0BAAUhB,aAAac;AAHjB;AAJoC,aAAlB,CAFF;;AAAA;AAEtBG,2BAFsB;;;AAa1Bb,gBAAIc,IAAJ,CAAS;AACP,wBAAS,GADF;AAEP,yBAAU,EAFH;AAGP,sBAAO,yBAAeD,eAAf;AAHA,aAAT;;AAb0B;AAAA;;AAAA;AAoB1Bb,gBAAIc,IAAJ,CAAS;AACPC,sBAAQ,GADD;AAEPC,uBAAS,EAFF;AAGPC,oBAAM;AAHC,aAAT;;AApB0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA9B;;AAAA;AAAA;AAAA;AAAA;;AA4BA;;;AAGAvB,OAAOI,GAAP,CAAW,QAAX,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvC,MAAI;AACF,QAAIC,QAAQ;AACVH,WAAKA,GADK;AAEVI,uBAAiB,IAFP;AAGVC,uBAAiB;AAHP,KAAZ;;AAMA,QAAIC,eAAe,iBAAWC,oBAAX,CAAgCJ,KAAhC,CAAnB;;AAEA,0BAAcG,YAAd,EAA4B,EAAE,SAAS,IAAX,EAA5B;;AAEA,WAAOL,IAAIO,MAAJ,CAAW,cAAX,EAA2BF,YAA3B,CAAP;AACD,GAZD,CAYE,OAAOa,CAAP,EAAU;AACV,qBAAOV,KAAP,iCAA2CU,CAA3C;AACD;AACF,CAhBD;;AAmBAC,OAAOC,OAAP,GAAiB1B,MAAjB","file":"common.js","sourcesContent":["import express from 'express'\nimport logger from '../../utils/logger'\nimport routerUtil from '../../utils/router'\nimport config from '../../utils/config';\n\nlet router = express.Router()\n\nlet wechatConfig = config.getWechat();\n\n/**\n * @desc 统一的出错页面\n */\nrouter.get('/error', async (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let templateData = routerUtil.getTemplateBasicData(param);\n\n    Object.assign(templateData, { 'title': '出错' })\n\n    return res.render('booking/room', templateData)\n  } catch (e) {\n    logger.error(`render_common_error_error=>${e}`)\n  }\n})\n\n/**\n * 获取微信的accessToken\n */\nrouter.get('/getAccessToken', async (req, res, next) => {\n  if (req.query.secret == wechatConfig.secret) {\n    let accessTokenInfo = await requestHelper.get({\n      \"moduleName\": \"wechat\",\n      \"controller\": \"common\",\n      \"action\": \"getAccessToken\",\n      \"data\": {\n        \"grant_type\": \"client_credential\",\n        \"appid\": wechatConfig.appid,\n        \"secret\": wechatConfig.secret\n      }\n    });\n\n    res.json({\n      \"status\":\"1\",\n      \"message\":\"\",\n      \"data\":JSON.stringify(accessTokenInfo)\n    })\n\n  } else {\n    res.json({\n      status: \"0\",\n      message: \"\",\n      data: null\n    })\n  }\n})\n\n/**\n * 公司介绍\n */\nrouter.get('/intro', (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let templateData = routerUtil.getTemplateBasicData(param);\n\n    Object.assign(templateData, { 'title': '介绍' })\n\n    return res.render('common/intro', templateData)\n  } catch (e) {\n    logger.error(`render_common_intro_error=>${e}`)\n  }\n})\n\n\nmodule.exports = router\n"]}