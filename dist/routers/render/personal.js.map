{"version":3,"sources":["../../../src/routers/render/personal.js"],"names":["router","Router","get","req","res","next","param","matchJavascript","matchStylesheet","templateData","getTemplateBasicData","memberId","requestHelper","balance","points","data","render","error","session","user","name","idCardNo","phoneNo","member","level","module","exports"],"mappings":"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","file":"personal.js","sourcesContent":["import express from 'express'\nimport logger from '../../utils/logger'\nimport routerUtil from '../../utils/router'\n\nlet router = express.Router()\n\nrouter.get('/list', async (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let templateData = routerUtil.getTemplateBasicData(param)\n\n    // let memberId = req.session.user.member.id\n    let memberId = 1\n\n    let balance = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'balance',\n      'action': 'total',\n      'data': {memberId}\n    })\n\n    let points = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'points',\n      'action': 'total',\n      'data': {memberId}\n    })\n\n    Object.assign(templateData, { 'title': '个人中心' }, {\n        balance: balance.data || 0, \n        points: points.data || 0 ,\n        // nickName:req.session.user.member.wechat.nickName,\n        // headImgUrl:req.session.user.member.wechat.headImgUrl,\n        // level:req.session.user.member.level\n      })\n\n    return res.render('personal/list', templateData)\n  } catch (e) {\n    logger.error(`render_personal_list_error=>${typeof e == 'string'? e:JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n// 消费记录\nrouter.get('/balance', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '帐户明细' })\n\n  return res.render('personal/balance', templateData)\n})\n\n// 个人信息\nrouter.get('/info', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '个人信息' },{\n    \"name\":req.session.user.name,\n    \"idCardNo\":req.session.user.idCardNo,\n    \"phoneNo\":req.session.user.phoneNo,\n    \"level\":req.session.user.member.level\n  })\n\n  return res.render('personal/info', templateData)\n})\n\n\n// 积分记录\nrouter.get('/credits', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '积分明细' })\n\n  return res.render('personal/credits', templateData)\n})\n\nmodule.exports = router\n"]}