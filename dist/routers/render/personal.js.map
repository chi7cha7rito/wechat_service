{"version":3,"sources":["../../../src/routers/render/personal.js"],"names":["router","Router","get","req","res","next","param","matchJavascript","matchStylesheet","templateData","getTemplateBasicData","memberId","session","user","member","id","requestHelper","totalInfo","wechatOpenId","wechat","memberInfo","data","balance","points","nickName","headImgUrl","level","memberLevel","name","render","error","idCardNo","phoneNo","module","exports"],"mappings":"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","file":"personal.js","sourcesContent":["import express from 'express'\nimport logger from '../../utils/logger'\nimport routerUtil from '../../utils/router'\n\nlet router = express.Router()\n\nrouter.get('/list', async (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let templateData = routerUtil.getTemplateBasicData(param)\n\n    let memberId = req.session.user.member.id\n\n    let totalInfo = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'member',\n      'action': 'findTotal',\n      'data': {memberId}\n    })\n\n    let memberInfo = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'member',\n      'action': 'find',\n      'data': {wechatOpenId:req.session.user.member.wechat.wechatOpenId}\n    })\n    req.session.user = memberInfo.data\n    Object.assign(templateData, { 'title': '个人中心' }, {\n        balance: (totalInfo.data && totalInfo.data.balance) || 0, \n        points: (totalInfo.data && totalInfo.data.points) || 0 ,\n        nickName:req.session.user.member.wechat.nickName,\n        headImgUrl:req.session.user.member.wechat.headImgUrl,\n        level:memberInfo.data.member.memberLevel.name\n      })\n\n    return res.render('personal/list', templateData)\n  } catch (e) {\n    logger.error(`render_personal_list_error=>${JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n// 消费记录\nrouter.get('/balance', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '帐户明细' })\n\n  return res.render('personal/balance', templateData)\n})\n\n// 个人信息\nrouter.get('/info', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '个人信息' },{\n    \"name\":req.session.user.name,\n    \"idCardNo\":req.session.user.idCardNo,\n    \"phoneNo\":req.session.user.phoneNo,\n    \"level\":req.session.user.member.memberLevel.name\n  })\n\n  return res.render('personal/info', templateData)\n})\n\n\n// 积分记录\nrouter.get('/credits', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '积分明细' })\n\n  return res.render('personal/credits', templateData)\n})\n\n//我的优惠券\nrouter.get('/coupon', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '我的优惠券' })\n\n  return res.render('personal/coupon', templateData)\n})\n\nmodule.exports = router\n"]}