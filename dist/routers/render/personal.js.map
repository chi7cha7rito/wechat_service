{"version":3,"sources":["../../../src/routers/render/personal.js"],"names":["router","Router","get","req","res","next","param","matchJavascript","matchStylesheet","templateData","getTemplateBasicData","memberId","session","user","member","id","requestHelper","balance","points","data","nickName","wechat","headImgUrl","level","memberLevel","name","render","error","idCardNo","phoneNo","module","exports"],"mappings":"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","file":"personal.js","sourcesContent":["import express from 'express'\nimport logger from '../../utils/logger'\nimport routerUtil from '../../utils/router'\n\nlet router = express.Router()\n\nrouter.get('/list', async (req, res, next) => {\n  try {\n    let param = {\n      req: req,\n      matchJavascript: true,\n      matchStylesheet: true\n    }\n\n    let templateData = routerUtil.getTemplateBasicData(param)\n\n    let memberId = req.session.user.member.id\n\n    let balance = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'balance',\n      'action': 'total',\n      'data': {memberId}\n    })\n\n    let points = await requestHelper.get({\n      'moduleName': 'hulk_service',\n      'controller': 'points',\n      'action': 'total',\n      'data': {memberId}\n    })\n\n    Object.assign(templateData, { 'title': '个人中心' }, {\n        balance: balance.data || 0, \n        points: points.data || 0 ,\n        nickName:req.session.user.member.wechat.nickName,\n        headImgUrl:req.session.user.member.wechat.headImgUrl,\n        level:req.session.user.member.memberLevel.name\n      })\n\n    return res.render('personal/list', templateData)\n  } catch (e) {\n    logger.error(`render_personal_list_error=>${JSON.stringify(e)}`)\n    return res.render('common/error')\n  }\n})\n\n// 消费记录\nrouter.get('/balance', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '帐户明细' })\n\n  return res.render('personal/balance', templateData)\n})\n\n// 个人信息\nrouter.get('/info', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '个人信息' },{\n    \"name\":req.session.user.name,\n    \"idCardNo\":req.session.user.idCardNo,\n    \"phoneNo\":req.session.user.phoneNo,\n    \"level\":req.session.user.member.memberLevel.name\n  })\n\n  return res.render('personal/info', templateData)\n})\n\n\n// 积分记录\nrouter.get('/credits', (req, res, next) => {\n  let param = {\n    req: req,\n    matchJavascript: true,\n    matchStylesheet: true\n  }\n\n  let templateData = routerUtil.getTemplateBasicData(param)\n\n  Object.assign(templateData, { 'title': '积分明细' })\n\n  return res.render('personal/credits', templateData)\n})\n\nmodule.exports = router\n"]}